<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">

    <body>
        <ui:composition template="./../WEB-INF/templates/header-template.xhtml">
            <ui:define name="content">
                    <h:form id="mainForm">
                            <p:dataTable id="impBrowserTable"
                                     var="appImp"
                                     selectionMode="single"
                                     value="#{backingBean.implementations}"
                                     paginator="true"
                                     paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                                     rowsPerPageTemplate="25,50,100"
                                     rowKey="#{appImp.appName}"
                                     rows="25">
                                <f:facet name="header">
                                    <div align="left">
                                        <h:outputText value="Implementations" style="font-size: 20pt"/>
                                        <p:commandButton icon="ui-icon-help" style="float: right" title="Help" onclick="helpImpsWidget.show();"/>
                                    </div>
                                </f:facet>
                                <p:column headerText="Submittable" sortBy="#{appImp.isSubmittable()}" style="width: 100px;">
                                   <p:outputPanel>
                                        <p:graphicImage value="/resources/images/disabled-grey.png"
                                                       width="26"
                                                       rendered="#{!appImp.isSubmittable()}"
                                                       style="border-style: none"
                                                        title="This implementation is not runnable within the SHIWA Simulation Platform"/>
                                        <p:graphicImage value="/resources/images/play-blue.png"
                                                        width="26"
                                                        rendered="#{!backingBean.isSspSession() and appImp.isSubmittable()}"
                                                        style="border-style: none"
                                                        title="This implementation is runnable within the SHIWA Simulation Platform"/>

                                        <p:outputPanel id="sspIcons" rendered="#{backingBean.isSspSession() and appImp.isSubmittable()}">
                                            <p:commandLink action="#{backingBean.selectImpForEmbedding()}"
                                                           title="Click to select workflow implementation for embedding in SSP"
                                                           ajax="true"
                                                           update="sspIcons,growl"
                                                           rendered="#{appImp.isSubmittable() and !backingBean.isImpSelectedForEmbedding(appImp.id)}">
                                                <p:graphicImage value="/resources/images/play-blue.png"
                                                            width="26"
                                                            style="border-style: none"/>
                                                <f:setPropertyActionListener value="#{appImp}" target="#{backingBean.selectedImp}"/>
                                            </p:commandLink>
                                            <p:commandLink action="#{backingBean.removeImpForEmbedding()}"
                                                           title="Click to remove item from the list of selected workflow implementations for emnedding in SSP"
                                                           ajax="true"
                                                           update="sspIcons,growl"
                                                           rendered="#{appImp.isSubmittable() and backingBean.isImpSelectedForEmbedding(appImp.id)}">
                                                <p:graphicImage value="/resources/images/play-blue-yellow.png"
                                                                width="26"
                                                                style="border-style: none"/>
                                                <f:setPropertyActionListener value="#{appImp}" target="#{backingBean.selectedImp}"/>
                                            </p:commandLink>
                                        </p:outputPanel>
                                    </p:outputPanel>
                                </p:column>
                                <p:column headerText="Workflow" sortBy="#{appImp.appName}" filterBy="#{appImp.appName}" filterMatchMode="contains">
                                    <f:facet name="header">Workflow</f:facet>
                                    <h:outputText value="#{backingBean.truncateForTable(appImp.appName)}" />
                                </p:column>
                                <p:column headerText="Engine" sortBy="#{appImp.platformName} (#{appImp.platformVersion})" filterBy="#{appImp.platformName} (#{appImp.platformVersion})" filterMatchMode="contains">
                                    <h:outputText value="#{appImp.platformName} (#{appImp.platformVersion})" />
                                </p:column>
                                <p:column headerText="Version" sortBy="#{appImp.version}" filterBy="#{appImp.version}" filterMatchMode="contains">
                                    <h:outputText value="#{appImp.version}" />
                                </p:column>
                                <p:column headerText="Status" sortBy="#{appImp.statusFriendlyName}" filterBy="#{appImp.statusFriendlyName}" filterMatchMode="contains">
                                    <h:outputText value="#{appImp.statusFriendlyName}" />
                                </p:column>
                                <p:column headerText="Popularity" sortBy="#{backingBean.getPercentPopImp(appImp)}">
                                    <h:outputText value="#{backingBean.getPercentPopImp(appImp)}%"/>
                                </p:column>
                                <p:column headerText="Rating" sortBy="#{backingBean.getRatingContext().getAVGRate(appImp.id)}">
                                    <h:outputText value="#{backingBean.getRatingContext().getAVGRate(appImp.id)}"/>
                                </p:column>
                                <p:column style="width:4%">
                                    <p:commandButton id="selectButton" immediate="true" actionListener="#{backingBean.onImplementationsOfSelectedApplicationRowSelectNavigate(appImp)}" icon="ui-icon-carat-1-e" title="View">
                                        <f:setPropertyActionListener value="#{appImp}" target="#{backingBean.selectedImp}" />
                                    </p:commandButton>
                                </p:column>
                            </p:dataTable>
                        <p:dialog header="Workflow Implementations Help"
                            id="helpImps"
                            widgetVar="helpImpsWidget"
                            modal="#{true}"
                            draggable="#{true}"
                            width="400"
                            closable="#{true}">
                        <p:outputPanel>
                          <p>
                              In this page we list all the different Workflow Implementations that have been created by our users that are available for you to see.
                              A Workflow Implementation is the concrete representation of the parent workflow. Usually this has specific data assigned to it. Such
                              as Submission Execution data and specific data sets as you will see if you select an Implementation from this page.
                          </p>
                          <h:panelGrid columns="2">
                              <p:graphicImage value="/resources/images/disabled-grey.png"
                                              width="26"
                                              style="border-style: none"/>
                              <p>
                                  If this image is displayed next to an Implementation it means that the developer has not enabled it as submittable using the Submission Service.
                                  This decision is entirely up to the developer to make however, is dependent on several factors:
                                  <ul>
                                      <li>The associated Workflow Engine (the Engine column below) must be supported by the Submission Service.</li>
                                      <li>The Implementation of the Workflow and the Workflow itself must be flagged as public.</li>
                                      <li>The Implementation must have a configured Submission Execution Node associated with it. This is viewable in the next screen
                                      and is a collection of specific parameters relevant to this particular Implementation's execution.</li>
                                  </ul>
                              </p>

                              <p:graphicImage value="/resources/images/play-blue.png"
                                              width="26"
                                              style="border-style: none"/>
                              <p>
                                  If this image is displayed it means that this Workflow Implementation has been flagged as Submittable by the developer. It may be
                                  selected for execution in the SSP platform.
                              </p>
                          </h:panelGrid>
                      </p:outputPanel>
                  </p:dialog>
                    </h:form>
            </ui:define>
        </ui:composition>
    </body>
</html>
